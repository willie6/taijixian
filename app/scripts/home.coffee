#Generated by CoffeeScript 1.7.1
fadeOut = (id, timeout) ->
  currentObject = $("." + id)
  maxHeight = parseInt currentObject.height 
  i = 0
  timer = setInterval(-> 
  	i++
  	value = parseFloat(i) * 0.01
  	currentObject.css({
  		'filter': 'alpha(opacity =' + i + ')' 
  		'-moz-opacity': value
  		'opacity': value
  		'height': maxHeight
  	})
  
	  if i == 100
	  	clearInterval timer
  , timeout)

fadeIn = (id, timeout) ->
  currentObject = $('.' + id)
  maxHeight = parseInt currentObject.height
  i = 100
  currentTimer = setInterval(-> 
  	value = parseFloat(i) * 0.01
  	currentObject.css({
  		'filter': 'alpha(opacity =' + i + ')' 
  		'-moz-opacity': value
  		'opacity': value
  		'height': maxHeight
  	})
  	
  	i--
  
	  if i == 500
	  	clearInterval currentTimer  
  , timeout)

$('.js-play-game').click( ->
  if (document.cookie) != ''
    cookiess = document.cookie.split(';')
    for cookieItem in cookiess
      if cookieItem.split('=')[0] == 'name'
        cookieValue = cookieItem.split('=')[1]
        if cookieValue == 'true'
          $(this).closest('div.js-paly-intro').css('display', 'none')
          $('.js-no-tip').click()
          break
      if cookieItem.index == (cookiess.length-1)
        $(this).closest('div.js-paly-intro').css('display', 'none')
        $('div.js-taiji-sec').css('display', 'block')
  else
    $(this).closest('div.js-paly-intro').css('display', 'none')
    $('div.js-taiji-sec').css('display', 'block')
)

option = {
  chart: 
    backgroundColor: 'black'
    renderTo: 'container'
    events : 
      load : -> 
        # set up the updating of the chart each second
        series = @series[0]
        setInterval (-> 
          x = (new Date()).getTime() # current time
          y = Math.round(Math.random() * 100)
          series.addPoint([x, y], true, true)
        ), 1000   
  ,
  title: 
    text: ''
    x: -20 #center
  ,
  subtitle: 
    text: ''
    x: -20
  ,
  colors: ['#0ff01a', '#38b843', '#ef3312', '#a04433']
  xAxis:
    type: 'datetime'
    gridLineWidth: 0
    lineWidth: 0
    tickPixelInterval: 100
    tickWidth: 0
    labels:
      enabled: false
  ,
  yAxis: 
    title: 
      text: ''
    ,
    gridLineColor: 'black'
    gridLineWidth: 0
    lineWidth: 0
    tickWidth: 0

  ,
  tooltip: 
    useHTML: true
    shared: true
    borderWidth: 0
    borderRadius: '10px'
    formatter: -> 
      "<div style='position: absolute; top:7px; border-color: transparent green transparent transparent; border-style: dashed dashed solid dashed; border-width: 8px'>" + 
      "<div style='position: absolute; border-color: transparent green transparent transparent; border-style: dashed dashed solid dashed; border-width:8px; top: -8px; left: -6px;'></div>" + 
      "<div></div></div><div style='position: relative; left: 16px; background: #084c1c; border: 2px solid green; border-radius: 10px; padding: 8px; font-size: 16px; display: block'>" + 
      "<span style='color: white; display: block;'>行情进入了绿色" + "<br/>" + "区域，太极线发出" + "<br/>" + "下跌信号，请点击</span>" + "<span style='color: #00f901; display: block'>\"卖出平仓\"</span></div>" 
  ,
  credits: 
    enabled: false
  ,
  navigator:
    enabled: false
  ,
  scrollbar:
    enabled: false
  ,
  legend:
    layout: 'vertical'
    align: 'right'
    verticalAlign: 'middle'
    borderWidth: 0
  ,
  rangeSelector: 
    buttons: [{
      count: 5
      type: 'minute'
      text: '1M'
    }]
    inputEnabled: false
    selected: 0
  ,

  series: [
    'id': 'kline'
    'name': 'k线'
    'type': 'candlestick'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
  ,
    'id': 'line1'
    'name': 'line1'
    'type': 'area'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color':'#00ff00'
    'lineColor': '#039a00'
  ,
    'id': 'line2'
    'name': 'line2'
    'type': 'area'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color': 'transparent'
    'lineColor': '#004e0a'
  ,
    'id': 'line3'
    'name': 'line3'
    'type': 'area'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color': 'transparent'
    'lineColor': '#707070'
  ,
    'id': 'line4'
    'name': 'line4'
    'type': 'area'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color': '#ff0000'
    'lineColor': '#3b0b0b'
  ,
    'id': 'line5'
    'name': 'line5'
    'type': 'area'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color': 'transparent'
    'lineColor': '#701a1d'
  ,
    'id': 'hideLine'
    'name': 'hideLine'
    'type': 'line'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'color': 'transparent'
  ,
    'id': 'guide'
    'name': 'guide'
    'type': 'flags'
    'data': [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
    'style':
      width: 10
      height: 10
  ],

  plotOptions: 
    flags:
      'animation': if animation? then animation else true
      'style': display: 'none'
    candlestick:
      'color': '#3F3'
      'lineColor': '#3F3'
      'upColor': '#FF2D19'
      'upLineColor': '#FF2D19'
      # 'enableMouseTracking': false
      'animation': if animation? then animation else true
    area:
      'stacking': 'normal'
      'lineColor': '#666666'
      'lineWidth': 1
      'marker':
        lineWidth: 1
        lineColor: '#666666'
      'enableMouseTracking': false
      'animation': if animation? then animation else true
    series:
      'fillOpacity': 0.1
      'threshold': null 
      'animation': if animation? then animation else true
}

# series: [{
#   name: 'Tokyo',
#   data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
# }, {
#   name: 'New York',
#   data: [0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
# }, {
#   name: 'Berlin',
#   data: [0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
# }, {
#   name: 'London',
#   data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
# }]

$('.js-no-tip').click(->
  document.cookie = 'name=' + window.encodeURI('true')

  $(this).closest('div.js-taiji-sec').css('display', 'none')
  $('div.js-loading-timer').css('display', 'block')
  $('body').addClass('bodyColor')
  j = 3
  yui = setInterval (->
    if j == 0 
      $('.count-downgo').css('display', 'block')
    if j == -1
      $('div.js-loading-timer').css('display', 'none')
      $('div.js-taiji-line').css('display', 'block')
      $('body').removeClass('bodyColor')
      clearInterval(yui)
      taijiChart = new Highcharts.Chart(option)
    else 
      $('.count-down' + (j+1)).css('display', 'none')
      $('.count-down' + j).css('display', 'block')
    j--
    return
  ), 1000
)

$ ->
  # 根据设备的宽度自适应
  bodyWidth = parseFloat($('html').width())
  currentDevWidth = bodyWidth * 100 / 320
  $('html').css('font-size', currentDevWidth)

  setTimeout (->
    fadeIn('index-bodybg', 10)
    $('.index-bodybg').css('display', 'none')
    $('div.js-paly-intro').css('display', 'block')
    return
  ), 1000
  return
        


	

